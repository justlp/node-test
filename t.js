var h = [
    {
        name: '!doctype',
        data: '!DOCTYPE html',
        type: 'directive',
        next: {
            type: 'tag',
            name: 'html',
            attribs: {},
            children: [
                {
                    type: 'tag',
                    name: 'head',
                    attribs: {},
                    children: [
                        {
                            type: 'tag',
                            name: 'meta',
                            attribs: {
                                charset: 'utf8'
                            },
                            children: [],
                            next: {
                                type: 'tag',
                                name: 'title',
                                attribs: {},
                                children: [
                                    {
                                        data: 'Page Title',
                                        type: 'text',
                                        next: null,
                                        prev: null,
                                        parent: ""
                                    }
                                ],
                                next: null,
                                prev: "",
                                parent: ""
                            },
                            prev: null,
                            parent: ""
                        },
                        {
                            type: 'tag',
                            name: 'title',
                            attribs: {},
                            children: [
                                {
                                    data: 'Page Title',
                                    type: 'text',
                                    next: null,
                                    prev: null,
                                    parent: ""
                                }
                            ],
                            next: null,
                            prev: "",
                            parent: ""
                        }
                    ],
                    next: {
                        type: 'tag',
                        name: 'body',
                        attribs: {},
                        children: [
                            {
                                type: 'tag',
                                name: 'div',
                                attribs: {
                                    class: 'block'
                                },
                                children: [
                                    {
                                        type: 'tag',
                                        name: 'div',
                                        attribs: {
                                            class: 'block__elem'
                                        },
                                        children: [
                                            {
                                                type: 'tag',
                                                name: 'h1',
                                                attribs: {
                                                    id: 'block__elem-title'
                                                },
                                                children: [
                                                    {
                                                        data: 'Page Title',
                                                        type: 'text',
                                                        next: null,
                                                        prev: null,
                                                        parent: ""
                                                    }
                                                ],
                                                next: {
                                                    type: 'tag',
                                                    name: 'p',
                                                    attribs: {
                                                        class: 'block__elem-paragraph'
                                                    },
                                                    children: [
                                                        {
                                                            data: 'This is a demo page',
                                                            type: 'text',
                                                            next: null,
                                                            prev: null,
                                                            parent: ""
                                                        }
                                                    ],
                                                    next: null,
                                                    prev: "",
                                                    parent: ""
                                                },
                                                prev: null,
                                                parent: ""
                                            },
                                            {
                                                type: 'tag',
                                                name: 'p',
                                                attribs: {
                                                    class: 'block__elem-paragraph'
                                                },
                                                children: [
                                                    {
                                                        data: 'This is a demo page',
                                                        type: 'text',
                                                        next: null,
                                                        prev: null,
                                                        parent: ""
                                                    }
                                                ],
                                                next: null,
                                                prev: "",
                                                parent: ""
                                            }
                                        ],
                                        next: null,
                                        prev: null,
                                        parent: ""
                                    }
                                ],
                                next: null,
                                prev: null,
                                parent: ""
                            }
                        ],
                        next: null,
                        prev: {
                            type: 'tag',
                            name: 'head',
                            attribs: {},
                            children: [
                                {
                                    type: 'tag',
                                    name: 'meta',
                                    attribs: {
                                        charset: 'utf8'
                                    },
                                    children: [],
                                    next: {
                                        type: 'tag',
                                        name: 'title',
                                        attribs: {},
                                        children: [
                                            {
                                                data: 'Page Title',
                                                type: 'text',
                                                next: null,
                                                prev: null,
                                                parent: ""
                                            }
                                        ],
                                        next: null,
                                        prev: "",
                                        parent: ""
                                    },
                                    prev: null,
                                    parent: ""
                                },
                                {
                                    type: 'tag',
                                    name: 'title',
                                    attribs: {},
                                    children: [
                                        {
                                            data: 'Page Title',
                                            type: 'text',
                                            next: null,
                                            prev: null,
                                            parent: ""
                                        }
                                    ],
                                    next: null,
                                    prev: "",
                                    parent: ""
                                }
                            ],
                            next: {
                                type: 'tag',
                                name: 'body',
                                attribs: {},
                                children: [
                                    {
                                        type: 'tag',
                                        name: 'div',
                                        attribs: {
                                            class: 'block'
                                        },
                                        children: [
                                            {
                                                type: 'tag',
                                                name: 'div',
                                                attribs: {
                                                    class: 'block__elem'
                                                },
                                                children: [
                                                    {
                                                        type: 'tag',
                                                        name: 'h1',
                                                        attribs: {
                                                            id: 'block__elem-title'
                                                        },
                                                        children: [
                                                            {
                                                                data: 'Page Title',
                                                                type: 'text',
                                                                next: null,
                                                                prev: null,
                                                                parent: ""
                                                            }
                                                        ],
                                                        next: "",
                                                        prev: null,
                                                        parent: ""
                                                    },
                                                    {
                                                        type: 'tag',
                                                        name: 'p',
                                                        attribs: "",
                                                        children: "",
                                                        next: null,
                                                        prev: "",
                                                        parent: ""
                                                    }
                                                ],
                                                next: null,
                                                prev: null,
                                                parent: ""
                                            }
                                        ],
                                        next: null,
                                        prev: null,
                                        parent: ""
                                    }
                                ],
                                next: null,
                                prev: "",
                                parent: ""
                            },
                            prev: null,
                            parent: ""
                        },
                        parent: ""
                    },
                    prev: null,
                    parent: ""
                },
                {
                    type: 'tag',
                    name: 'body',
                    attribs: {},
                    children: [
                        {
                            type: 'tag',
                            name: 'div',
                            attribs: {
                                class: 'block'
                            },
                            children: [
                                {
                                    type: 'tag',
                                    name: 'div',
                                    attribs: {
                                        class: 'block__elem'
                                    },
                                    children: [
                                        {
                                            type: 'tag',
                                            name: 'h1',
                                            attribs: {
                                                id: 'block__elem-title'
                                            },
                                            children: [
                                                {
                                                    data: 'Page Title',
                                                    type: 'text',
                                                    next: null,
                                                    prev: null,
                                                    parent: ""
                                                }
                                            ],
                                            next: {
                                                type: 'tag',
                                                name: 'p',
                                                attribs: {
                                                    class: 'block__elem-paragraph'
                                                },
                                                children: [
                                                    {
                                                        data: 'This is a demo page',
                                                        type: 'text',
                                                        next: null,
                                                        prev: null,
                                                        parent: ""
                                                    }
                                                ],
                                                next: null,
                                                prev: "",
                                                parent: ""
                                            },
                                            prev: null,
                                            parent: ""
                                        },
                                        {
                                            type: 'tag',
                                            name: 'p',
                                            attribs: {
                                                class: 'block__elem-paragraph'
                                            },
                                            children: [
                                                {
                                                    data: 'This is a demo page',
                                                    type: 'text',
                                                    next: null,
                                                    prev: null,
                                                    parent: ""
                                                }
                                            ],
                                            next: null,
                                            prev: "",
                                            parent: ""
                                        }
                                    ],
                                    next: null,
                                    prev: null,
                                    parent: ""
                                }
                            ],
                            next: null,
                            prev: null,
                            parent: ""
                        }
                    ],
                    next: null,
                    prev: "",
                    parent: ""
                }
            ],
            next: null,
            prev: "",
            parent: null,
        },
        prev: null,
        parent: null
    },
    {
        type: 'tag',
        name: 'html',
        attribs: {},
        children: [
            {
                type: 'tag',
                name: 'head',
                attribs: {},
                children: [
                    {
                        type: 'tag',
                        name: 'meta',
                        attribs: {
                            charset: 'utf8'
                        },
                        children: [],
                        next: {
                            type: 'tag',
                            name: 'title',
                            attribs: {},
                            children: [
                                {
                                    data: 'Page Title',
                                    type: 'text',
                                    next: null,
                                    prev: null,
                                    parent: ""
                                }
                            ],
                            next: null,
                            prev: "",
                            parent: ""
                        },
                        prev: null,
                        parent: ""
                    },
                    {
                        type: 'tag',
                        name: 'title',
                        attribs: {},
                        children: [
                            {
                                data: 'Page Title',
                                type: 'text',
                                next: null,
                                prev: null,
                                parent: ""
                            }
                        ],
                        next: null,
                        prev: "",
                        parent: ""
                    }
                ],
                next: {
                    type: 'tag',
                    name: 'body',
                    attribs: {},
                    children: [
                        {
                            type: 'tag',
                            name: 'div',
                            attribs: {
                                class: 'block'
                            },
                            children: [
                                {
                                    type: 'tag',
                                    name: 'div',
                                    attribs: {
                                        class: 'block__elem'
                                    },
                                    children: [
                                        {
                                            type: 'tag',
                                            name: 'h1',
                                            attribs: {
                                                id: 'block__elem-title'
                                            },
                                            children: [
                                                {
                                                    data: 'Page Title',
                                                    type: 'text',
                                                    next: null,
                                                    prev: null,
                                                    parent: ""
                                                }
                                            ],
                                            next: {
                                                type: 'tag',
                                                name: 'p',
                                                attribs: {
                                                    class: 'block__elem-paragraph'
                                                },
                                                children: [
                                                    {
                                                        data: 'This is a demo page',
                                                        type: 'text',
                                                        next: null,
                                                        prev: null,
                                                        parent: ""
                                                    }
                                                ],
                                                next: null,
                                                prev: "",
                                                parent: ""
                                            },
                                            prev: null,
                                            parent: ""
                                        },
                                        {
                                            type: 'tag',
                                            name: 'p',
                                            attribs: {
                                                class: 'block__elem-paragraph'
                                            },
                                            children: [
                                                {
                                                    data: 'This is a demo page',
                                                    type: 'text',
                                                    next: null,
                                                    prev: null,
                                                    parent: ""
                                                }
                                            ],
                                            next: null,
                                            prev: "",
                                            parent: ""
                                        }
                                    ],
                                    next: null,
                                    prev: null,
                                    parent: ""
                                }
                            ],
                            next: null,
                            prev: null,
                            parent: ""
                        }
                    ],
                    next: null,
                    prev: "",
                    parent: ""
                },
                prev: null,
                parent: ""
            },
            {
                type: 'tag',
                name: 'body',
                attribs: {},
                children: [
                    {
                        type: 'tag',
                        name: 'div',
                        attribs: {
                            class: 'block'
                        },
                        children: [
                            {
                                type: 'tag',
                                name: 'div',
                                attribs: {
                                    class: 'block__elem'
                                },
                                children: [
                                    {
                                        type: 'tag',
                                        name: 'h1',
                                        attribs: {
                                            id: 'block__elem-title'
                                        },
                                        children: [
                                            {
                                                data: 'Page Title',
                                                type: 'text',
                                                next: null,
                                                prev: null,
                                                parent: ""
                                            }
                                        ],
                                        next: {
                                            type: 'tag',
                                            name: 'p',
                                            attribs: {
                                                class: 'block__elem-paragraph'
                                            },
                                            children: [
                                                {
                                                    data: 'This is a demo page',
                                                    type: 'text',
                                                    next: null,
                                                    prev: null,
                                                    parent: ""
                                                }
                                            ],
                                            next: null,
                                            prev: "",
                                            parent: ""
                                        },
                                        prev: null,
                                        parent: ""
                                    },
                                    {
                                        type: 'tag',
                                        name: 'p',
                                        attribs: {
                                            class: 'block__elem-paragraph'
                                        },
                                        children: [
                                            {
                                                data: 'This is a demo page',
                                                type: 'text',
                                                next: null,
                                                prev: null,
                                                parent: ""
                                            }
                                        ],
                                        next: null,
                                        prev: "",
                                        parent: ""
                                    }
                                ],
                                next: null,
                                prev: null,
                                parent: ""
                            }
                        ],
                        next: {
                            type: 'tag',
                            name: 'span'
                        },
                        prev: "",
                        parent: ""
                    },
                    {
                        type: 'tag',
                        name: 'span',
                        attribs: {
                            class: 'block2'
                        },
                        children: [
                            {
                                type: 'tag',
                                name: 'div',
                                attribs: {
                                    class: 'block2__elem'
                                },
                                children: [
                                    {
                                        type: 'tag',
                                        name: 'h1',
                                        attribs: {
                                            id: 'block__elem-title'
                                        },
                                        children: [
                                            {
                                                data: 'Page Title',
                                                type: 'text',
                                                next: null,
                                                prev: null,
                                                parent: ""
                                            }
                                        ],
                                        next: {
                                            type: 'tag',
                                            name: 'p',
                                            attribs: {
                                                class: 'block__elem-paragraph'
                                            },
                                            children: [
                                                {
                                                    data: 'This is a demo page',
                                                    type: 'text',
                                                    next: null,
                                                    prev: null,
                                                    parent: ""
                                                }
                                            ],
                                            next: null,
                                            prev: "",
                                            parent: ""
                                        },
                                        prev: null,
                                        parent: ""
                                    },
                                    {
                                        type: 'tag',
                                        name: 'p',
                                        attribs: {
                                            class: 'block__elem-paragraph'
                                        },
                                        children: [
                                            {
                                                data: 'This is a demo page',
                                                type: 'text',
                                                next: null,
                                                prev: null,
                                                parent: ""
                                            }
                                        ],
                                        next: null,
                                        prev: "",
                                        parent: ""
                                    }
                                ],
                                next: null,
                                prev: null,
                                parent: ""
                            }
                        ],
                        next: null,
                        prev: "",
                        parent: ""
                    }
                ],
                next: null,
                prev: "",
                parent: ""
            }
        ],
        next: null,
        prev: "",
        parent: null
    }
];

// next null
// если в children нет type tag, то внутри только текст

var body = h[1].children[1];


var makeTree = function (body){
    var _nodes = {},
        item,
        item2,
        _item = {};

    var arr = [];


    if (!(body.next) && ("type" in body) && ("attribs" in body)){
        for (var i=0; i<body.children.length; i++){
            item = body.children[i];
            _item = {};
            
            for (var j=0; j<item.children.length; j++){
                item2 = item.children[j];

                if ("attribs" in item2) {
                    if ( item2.attribs.class.indexOf(item.attribs.class + '_') != -1 ) {
                        //_nodes[item.attribs.class] = item;
                        //console.log(item);

                        arr = arr.concat(item);
                    }
                }
            }
        }
    }

    return arr;
};

var t = makeTree(body);
console.log(t);

